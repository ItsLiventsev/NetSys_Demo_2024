# **demo2024**

**DEMO2024**

_–í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —Ä–µ—à–µ–Ω–∏—è—Ö –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –ë–∞–∑–∞–ª—å—Ç - –ê–ª—å—Ç –°–µ—Ä–≤–µ—Ä 10.1 –∏ –ê–ª—å—Ç –†–∞–±–æ—á–∞—è —Å—Ç–∞–Ω—Ü–∏—è 10.1, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º BRANCH_:

- ISP - –ê–ª—å—Ç –°–µ—Ä–≤–µ—Ä 10.1 (CLI)
- CLI - –ê–ª—å—Ç –†–∞–±–æ—á–∞—è —Å—Ç–∞–Ω—Ü–∏—è 10.1 (GUI)
- HQ-R - –ê–ª—å—Ç –°–µ—Ä–≤–µ—Ä 10.1 (CLI)
- HQ-SRV - –ê–ª—å—Ç –°–µ—Ä–≤–µ—Ä 10.1 (GUI)
- BR-R - –†–ï–î –û–° –ú—É—Ä–æ–º 7.3.3 (CLI)
- BR-SRV - –†–ï–î –û–° –ú—É—Ä–æ–º 7.3.3 (CLI)

‚Äã**[–ó–∞–¥–∞–Ω–∏—è](https://bom.firpo.ru/Public/83)****‚Äã**

**–û–±—Ä–∞–∑–µ—Ü –∑–∞–¥–∞–Ω–∏—è**

–û–±—Ä–∞–∑–µ—Ü –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ –ø–æ –∫–æ–º–ø–ª–µ–∫—Ç—É –æ—Ü–µ–Ω–æ—á–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–¢–æ–ø–æ–ª–æ–≥–∏—è —Å–µ—Ç–∏**

![](RackMultipart20231206-1-ro26pu_html_382db1e8be596e0.png)

img

–ü–æ—Å–∫–æ–ª—å–∫—É –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —Å –ø–∞–∫–µ—Ç–∞–º–∏, –∑–Ω–∞—á–∏—Ç –∫ **ISP** –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ —Å–µ—Ç—å "VM Network" –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –Ω–∞—Å—Ç–æ—è—â—É—é —Å–µ—Ç—å –ò–Ω—Ç–µ—Ä–Ω–µ—Ç

**–ó–∞–¥–∞–Ω–∏–µ 1 –º–æ–¥—É–ª—è 1**

**1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –±–∞–∑–æ–≤—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**

**a. –ü—Ä–∏—Å–≤–æ–∏—Ç—å –∏–º–µ–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π**

hostnamectl set-hostname \<NAME\>; execbash

–≥–¥–µ:

- **\<NAME\>** - –∏–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **exec bash** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –æ–±–æ–ª–æ—á–∫–∏ bash –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ö–æ—Å—Ç–Ω–µ–π–º–∞

–í—ã–ø–æ–ª–Ω—è–µ–º –Ω–∞ –≤—Å–µ—Ö —Ö–æ—Å—Ç–∞—Ö.

–ü—Ä–∏–º–µ—Ä:

hostnamectl set-hostname isp; execbash

![](RackMultipart20231206-1-ro26pu_html_952ba0962431ee3.png)

img

**b. –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ IP-–∞–¥—Ä–µ—Å–∞—Ü–∏—é IPv4 –∏ IPv6.**

_–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É ‚Ññ1, —á—Ç–æ–±—ã —ç–∫—Å–ø–µ—Ä—Ç—ã –º–æ–≥–ª –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞—à–µ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ._

**c. –ü—É–ª –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è —Å–µ—Ç–∏ –æ—Ñ–∏—Å–∞ BRANCH - –Ω–µ –±–æ–ª–µ–µ 16**

**d. –ü—É–ª –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è —Å–µ—Ç–∏ –æ—Ñ–∏—Å–∞ HQ - –Ω–µ –±–æ–ª–µ–µ 64**

**–¢–∞–±–ª–∏—Ü–∞ ‚Ññ1**

| –ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | IP | Text | Network | Class | hosts |
| --- | --- | --- | --- | --- | --- |
| CLI | 3.3.3.2/30 | CLI ‚Äî ISP | 3.3.3.0/30 | A | 2 |
| --- | --- | --- | --- | --- | --- |
| ‚Äã | 2001:3::2/64 | ‚Äã | 2001:3::/64 | ‚Äã | ... |
| ‚Äã | 4.4.4.2/30 | CLI ‚Äî HQ-R | 4.4.4.0/30 | A | 2 |
| ‚Äã | 2001:4::2/64 | ‚Äã | 2001:4::/64 | ‚Äã | ... |
| ISP | 3.3.3.1/30 | ISP ‚Äî CLI | 3.3.3.0/30 | A | 2 |
| ‚Äã | 2001:3::1/64 | ‚Äã | 2001:3::/64 | ‚Äã | ... |
| ‚Äã | 1.1.1.1/30 | ISP ‚Äî HQ-R | 1.1.1.0/30 | A | 2 |
| ‚Äã | 2001:1::1/64 | ‚Äã | 2001:1::/64 | ‚Äã | ... |
| ‚Äã | 2.2.2.1/30 | ISP ‚Äî BR-R | 2.2.2.0/30 | A | 2 |
| ‚Äã | 2001:2::1/64 | ‚Äã | 2001:2::/64 | ‚Äã | ... |
| HQ-R | 1.1.1.2/30 | ISP ‚Äî HQ-R | 1.1.1.0/30 | A | 2 |
| ‚Äã | 2001:1::2/64 | ‚Äã | 2001:1::/64 | ‚Äã | ... |
| ‚Äã | 192.168.100.62/26 | HQ | 192.168.100.0/26 | C | 62 |
| ‚Äã | 2001üíØ:3f/122 | ‚Äã | 2001üíØ:/122 | ‚Äã | 64 |
| ‚Äã | 4.4.4.1/30 | CLI ‚Äî HQ-R | 4.4.4.0/30 | A | 2 |
| ‚Äã | 2001:4::1/64 | ‚Äã | 2001:4::/64 | ‚Äã | ... |
| ‚Äã | 172.16.100.1/24 | TUNNEL | 172.16.100.0/24 | ‚Äã | 254 |
| ‚Äã | 2001:5:1/64 | ‚Äã | 2001:5::/64 | ‚Äã | ... |
| HQ-SRV | 192.168.100.1/26 (DHCP) | HQ | 192.168.100.0/26 | C | 62 |
| ‚Äã | 2001üíØ:1/122 (DHCP) | ‚Äã | 2001üíØ:/122 | ‚Äã | 64 |
| BR-R | 2.2.2.2/30 | ISP ‚Äî BR-R | 2.2.2.0/30 | A | 2 |
| ‚Äã | 2001:2::2/64 | ‚Äã | 2001:2::/64 | ‚Äã | ... |
| ‚Äã | 192.168.200.14/28 | BR | 192.168.200.0/28 | C | 14 |
| ‚Äã | 2001:200::f/124 | ‚Äã | 2001:200::/124 | ‚Äã | 16 |
| ‚Äã | 172.16.100.2/24 | TUNNEL | 172.16.100.0/24 | ‚Äã | 254 |
| ‚Äã | 2001:5:2/64 | ‚Äã | 2001:5::/64 | ‚Äã | ... |
| BR-SRV | 192.168.200.1/28 | BR | 192.168.200.0/28 | C | 14 |
| ‚Äã | 2001:200::1/124 | ‚Äã | 2001:200::/124 | ‚Äã | 16 |
| HQ-CLI | DHCP | HQ | 192.168.100.0/26 | C | 62 |
| ‚Äã | DHCP | ‚Äã | 2001üíØ:/122 | ‚Äã | 64 |
| HQ-AD | 192.168.100.2/26 | HQ | 192.168.100.0/26 | C | 62 |
| ‚Äã | 2001üíØ:2/122 | ‚Äã | 2001:5::/122 | ‚Äã | 64 |

–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π:

ip-c a

![](RackMultipart20231206-1-ro26pu_html_54700fa5f9b4c897.png)

img

_–ö—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–≤ –ø—Ä–∏–º–µ—Ä–µ –æ–Ω–æ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è!), –æ—Ä–∞–Ω–∂–µ–≤—ã–º —Ü–≤–µ—Ç–æ–º ‚Äî –µ–≥–æ MAC-–∞–¥—Ä–µ—Å (–≤ –ø—Ä–∏–º–µ—Ä–µ MAC-–∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è!). –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫—É–¥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –∏—Ö MAC-–∞–¥—Ä–µ—Å–∞–º. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã, –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å MAC-–∞–¥—Ä–µ—Å (–∫–Ω–æ–ø–∫–∞ Advanced) –∏ —Å–µ—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ù–∞–∂–∞—Ç–∏–µ–º –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏ –Ω–∞ –∏–º—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫—Ä—ã—Ç—å –µ–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏._

- –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

**ISP**

–í –∫–∞—á–µ—Å—Ç–≤–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **[etcnet](https://www.opennet.ru/man.shtml?topic=etcnet&category=8&russian=0)**‚Äã

- –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ **[etcnet –≤ –ê–ª—å—Ç](https://www.altlinux.org/Etcnet)**‚Äã

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ –ø—É—Ç–∏ **/etc/net/ifaces/\<NAME\_INTERFACE\>/options** :

- –≥–¥–µ - **\<NAME\_INTERFACE\>** –∏–º—è —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

mkdir /etc/net/ifaces/ens3{6..8}

–¥–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–º–µ–Ω—è–µ—Ç 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

mkdir /etc/net/ifaces/ens36

mkdir /etc/net/ifaces/ens37

mkdir /etc/net/ifaces/ens38

![](RackMultipart20231206-1-ro26pu_html_76a9faa5f93865a5.png)

img

–¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª **[options](https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=etcnet-options&category=5)** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/etc/net/ifaces/\<NAME\_INTERFACE\>**

–ü—Ä–∏–º–µ—Ä–¥–ª—è–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ens36:

vim /etc/net/ifaces/ens34/options

![](RackMultipart20231206-1-ro26pu_html_93c48ad271a25f1f.png)

img

–≥–¥–µ:

- **TYPE** - –≠—Ç–∞ –æ–ø—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞;
- **DISABLED** - –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ "yes", —Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è;
- **NM\_CONTROLLED** - –í —Å–æ—á–∏—Ç–∞–Ω–∏–µ —Å **DISABLED=no** –ø–æ–ª—É—á–∞–µ—Ç—Å—è —á–∏—Å—Ç—ã–π Etcnet;
- **BOOTPROTO** - –ú–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö: static, dhcp, ipv4ll. \* "static": –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ipv4address/ipv6address;

–ü–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–¥–µ–Ω—Ç–∏—á–µ–Ω –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ ens37 –∏ ens38 - –µ–≥–æ –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

cp /etc/net/ifaces/ens36/options /etc/net/ifaces/ens37/

cp /etc/net/ifaces/ens36/options /etc/net/ifaces/ens37/

–ò–ª–∏ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç—ã–º bash-—Å–∫—Ä–∏–ø—Ç–æ–º —Å—Ä–∞–∑—É –∑–∞–ø–∏—Å–∞—Ç—å –≤—Å–µ –æ–ø—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:

foriin678; do

cat\<\<EOF \> /etc/net/ifaces/ens3$i/options

TYPE=eth

DISABLED=no

NM\_CONTROLLED=no

BOOTPROTO=static

CONFIG\_IPV4=YES

CONFIG\_IPV6=YES

EOF

done

–¢–µ–ø–µ—Ä—å –Ω–∞–∑–Ω–∞—á–∞–µ–º IPv4 –∏ IPv6 -–∞–¥—Ä–µ—Å–∞ –Ω–∞ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¢–∞–±–ª–∏—Ü–∞ ‚Ññ1

**ens36** - ISP-HQ

echo1.1.1.1/30 \> /etc/net/ifaces/ens36/ipv4address

echo2001:1::1/64 \> /etc/net/ifaces/ens36/ipv6address

**ens37** - ISP-BRANCH

echo2.2.2.1/30 \> /etc/net/ifaces/ens37/ipv4address

echo2001:2::1/64 \> /etc/net/ifaces/ens37/ipv6address

**ens38** - ISP-CLI

echo3.3.3.1/30 \> /etc/net/ifaces/ens38/ipv4address

echo2001:3::1/64 \> /etc/net/ifaces/ens38/ipv6address

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:

![](RackMultipart20231206-1-ro26pu_html_fe355a2b8a9b7424.png)

img

–í–∫–ª—é—á–µ–Ω–∏–µ IPv6:

—Å–ª–µ–¥—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ CONFIG\_IPV6 –≤ etcnet. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è–º–æ–∂–µ—Ç–±—ã—Ç—å–æ–ø–∏—Å–∞–Ω–∞–≤ **/etc/net/options.d/\*** , **/etc/net/ifaces/default/\*** , **/etc/net/ifaces/\*/options**.

**–ù–∞–∏–±–æ–ª—å—à–∏–π**** –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç **** ‚Äî **** —É ****–æ–ø–∏—Å–∞–Ω–∏—è**** –≤ **** /etc/net/ifaces/\<NAME\_INTERFACE\>/options**.

P.S. –í–≤–µ—Ä—Å–∏–∏ etcnet-0.9.26-alt1, –≤ **/etc/net/ifaces/default/options** —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è CONFIG\_IPV6=no

–ü–æ—ç—Ç–æ–º—É–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–ø–µ—Ä–µ–π—Ç–∏–≤–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π—Ñ–∞–π–ª " **/etc/net/ifaces/default/options**" –∏–ø–æ–º–µ–Ω—è—Ç—å–∑–Ω–∞—á–µ–Ω–∏–µ " **CONFIG\_IPV6=no** –Ω–∞ **CONFIG\_IPV6=yes**

vim /etc/net/ifaces/default/options

![](RackMultipart20231206-1-ro26pu_html_2bc1e7eb4efc1572.png)

img

–∏–ª–∏:

sed-i's/CONFIG\_IPV6=no/CONFIG\_IPV6=yes/g' /etc/net/ifaces/default/options

–ó–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ–º forwarding –¥–ª—è IPv4 –∏ IPv6 –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–æ –ø—É—Ç–∏ **/etc/net/sysctl.conf**

vim /etc/net/sysctl.conf

–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ—á–∫–∏:

![](RackMultipart20231206-1-ro26pu_html_e2a495e06aa24826.png)

img

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª—É–∂–±—É "network"

systemctl restart network

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

ip-c a

![](RackMultipart20231206-1-ro26pu_html_9e9b487b26e1cb9b.png)

img

![](RackMultipart20231206-1-ro26pu_html_45dcfea92ba5c748.png)

img

**CLI**

–í —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞—Ö –û–° –ê–ª—å—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à—Ç–∞—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è NetworkManager; –ø—Ä–∏ —ç—Ç–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–æ –µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å etcnet, –∞ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ alterator-net-eth –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–∫–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º–æ–π –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è.

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –≤ MATE/Cinnamon/Xfce –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ø–ø–ª–µ—Ç NetworkManager. –û–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ç—Ä–µ–µ.

–¢–∞–∫–∂–µ –≤ alterator –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ç–µ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑—ã–≤–∞—Ç—å—Å—è –∏–º–µ–Ω–Ω–æ –æ–Ω:

- –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–∂–∏–º–∞–µ–º "–ú–µ–Ω—é" (–∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ü—É—Å–∫") -\> –¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -\> –¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π (–¶–£–°)

![](RackMultipart20231206-1-ro26pu_html_75809213094a9d1b.png)

img

- –≤–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (root)

![](RackMultipart20231206-1-ro26pu_html_a4b48aaf45934a05.png)

img

- –í—ã–±–∏—Ä–∞–µ–º "Ethernet-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã"

![](RackMultipart20231206-1-ro26pu_html_8aaa03d282dd2eee.png)

img

- –í—ã–±–∏—Ä–∞–µ–º —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (ens33 - –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP) -\> –Ω–∞–∂–∏–º–∞–µ–º "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ" -\> –≤—ã–±–∏—Ä–∞–µ–º —Å–µ—Ç–µ—É—é –ø–æ–¥—Å–∏—Å—Ç–µ–º—É "NetworkManager(native)" -\> –Ω–∞–∂–∏–º–∞–µ–º "–û–ö" -\> –Ω–∞–∂–∏–º–∞–µ–º "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"

![](RackMultipart20231206-1-ro26pu_html_2c09e7fa56a3bae7.png)

img

- _–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞_ _ **ens36 - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ HQ-R** _

–ü–æ—Å–ª–µ —á–µ–≥–æ –ø–æ–∂–º–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã IPv4 –∏ IPv6 –∞–¥—Ä–µ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ø–ø–ª–µ—Ç NetworkManager

- "–ü–ö–ú" –Ω–∞–∂–∏–º–∞–µ–º –Ω–∞ –∑–Ω–∞—á—ë–∫ –≤ —Ç—Ä–µ–µ -\> –∑–∞—Ç–µ–º –≤—ã–±–∏—Ä–∞–µ–º "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π"

![](RackMultipart20231206-1-ro26pu_html_906ce45c410901d6.png)

img

- –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP

![](RackMultipart20231206-1-ro26pu_html_c5fd2e6bd3ec6a33.png)

img

- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–∞—ë–º –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) -\> –≤—ã–±–∏—Ä–∞–µ–º —Å–µ—Ç–µ—Ñ–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ens33 -\> –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã IPv4"

![](RackMultipart20231206-1-ro26pu_html_b9730fdefc2e2d4d.png)

img

- –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç–æ–¥–∞ –≤—ã–±–∏—Ä–∞–µ–º "–í—Ä—É—á–Ω—É—é" -\> –Ω–∞–∂–∏–º–∞–µ–º "–î–æ–±–∞–≤–∏—Ç—å" -\> –∑–∞–¥–∞—ë–º IPv4-–∞–¥—Ä–µ—Å -\> –∑–∞–¥–∞—ë–º –º–∞—Å–∫—É -\> –∑–∞–¥–∞—ë–º —à–ª—é–∑ -\> –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã IPv6"

![](RackMultipart20231206-1-ro26pu_html_953d834ee2cc32a5.png)

img

- –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç–æ–¥–∞ –≤—ã–±–∏—Ä–∞–µ–º "–í—Ä—É—á–Ω—É—é" -\> –Ω–∞–∂–∏–º–∞–µ–º "–î–æ–±–∞–≤–∏—Ç—å" -\> –∑–∞–¥–∞—ë–º IPv6-–∞–¥—Ä–µ—Å -\> –∑–∞–¥–∞—ë–º –º–∞—Å–∫—É -\> –∑–∞–¥–∞—ë–º —à–ª—é–∑ -\> –Ω–∞–∂–∏–º–∞–µ–º "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

![Shape1](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

–û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª —Å–æ—á–µ—Ç–∞–Ω–∏–µ–º –∫–ª–∞–≤–∏—á "Ctrl + Alt + T"

![](RackMultipart20231206-1-ro26pu_html_5ca73e4369ca806f.png)

img

–ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∫ ISP:

![](RackMultipart20231206-1-ro26pu_html_894fe24b8b689581.png)

img

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å HQ-R

**HQ-R**

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ISP (—Ç.–∫. –æ–±–∞ –Ω–∞ –±–∞–∑–µ –ê–ª—å—Ç –°–µ—Ä–≤–µ—Ä 10.1 –∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–∏—Å—Ç–µ–º—ã —Å–µ—Ç–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è etcnet)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∞–¥—Ä–µ—Å–∞—Ü–∏—è –Ω–∞ HQ-R –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–µ–π:

![](RackMultipart20231206-1-ro26pu_html_442231e242c8ae34.png)

img

- **ens33** - HQ-R -\> ISP
- **ens36** - HQ-R -\> LocalNetwork HQ
- **ens37** - HQ-R -\> CLI (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

–¢–∞–∫–∂–µ, –ø–æ—Å–∫–æ–ª—å–∫—É HQ-R —è–≤–ª—è–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–º –¥–ª—è –æ—Ñ–∏—Å–∞ HQ - –Ω–µ–∑–∞–±—ã–≤–∞–µ–º –≤–∫–ª—é—á–∏—Ç—å **forwarding** –∫–∞–∫ –¥–ª—è IPv4 —Ç–∞–∫ –∏ –¥–ª—è IPv6 - –ø–∞–∫–µ—Ç–æ–≤

–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º:

![](RackMultipart20231206-1-ro26pu_html_f48510ee7519e253.png)

img

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–Ω–æ—Å—Ç—å —Å ISP:

![](RackMultipart20231206-1-ro26pu_html_707db5d4923c6531.png)

img

**BR-R**

–í –∫–∞—á–µ—Å—Ç–≤–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [NetworkManager](https://networkmanager.dev/docs/admins/)‚Äã

–ë—ã—Å—Ç—Ä–µ–µ –∏ –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —É—Ç–∏–ª–∏—Ç–æ–π **nmtui**

‚Äã[nmtui](https://redos.red-soft.ru/base/manual/redos-manual/network/network-settings/) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ —Å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ-–ø–æ–Ω—è—Ç–Ω—ã–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –¥–ª—è –µ–µ –∑–∞–ø—É—Å–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

nmtui

- –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Å—Ç—Ä–µ–ª–æ–∫ –∏ –∫–ª–∞–≤–∏—à–∏ "Tab"
- –≤—ã–±–∏—Ä–∞–µ–º "–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"

![](RackMultipart20231206-1-ro26pu_html_196ea7c844abe67c.png)

img

- –≤—ã–±–∏—Ä–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ - ens33 –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP

![](RackMultipart20231206-1-ro26pu_html_c080076acefd154c.png)

img

- –∑–∞–¥–∞—ë–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–Ω—è—Ç–Ω–æ–µ "–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è" -\> –≤ "–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø IPv4" –≤—ã–±–∏—Ä–∞–µ–º "–í—Ä—É—á–Ω—É—é" -\> –∑–∞–¥–∞—ë–º IPv4 –∞–¥—Ä–µ—Å —Å –º–∞—Å–∫–æ–π -\> –∑–∞–¥–∞—ë–º —à–ª—é–∑ -\> –≤ "–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø IPv6" –≤—ã–±–∏—Ä–∞–µ–º "–í—Ä—É—á–Ω—É—é" -\> –∑–∞–¥–∞—ë–º IPv6 –∞–¥—Ä–µ—Å —Å –º–∞—Å–∫–æ–π -\> –∑–∞–¥–∞—ë–º —à–ª—é–∑ -\> –Ω–∞–∂–∏–º–∞–µ–º "–û–ö"

![Shape2](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

- –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –æ—Ñ–∏—Å–∞ BRANCH:

![](RackMultipart20231206-1-ro26pu_html_37793f4f1f07f75e.png)

img

![Shape3](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

- –Ω–∞–∂–∏–º–∞–µ–º "–ù–∞–∑–∞–¥"

![Shape4](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

- –≤—ã–±–∏—Ä–∞–µ–º "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"

![](RackMultipart20231206-1-ro26pu_html_9fa6936cf65b1f07.png)

img

- –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å - –æ—Ç–∫–ª—é—á–∞–µ–º –∏ –≤–∫–ª–±—é—á–∞–µ–º —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã -\> –ø–æ—Å–ª–µ—á–µ–≥–æ –≤—ã–±–∏—Ä–∞–µ–º "–ù–∞–∑–∞–¥"

![](RackMultipart20231206-1-ro26pu_html_841e11cce075467e.png)

img

- –Ω–∞–∂–∏–º–∞–µ–º "–í—ã–π—Ç–∏"

![](RackMultipart20231206-1-ro26pu_html_e099b15b947bde5d.png)

img

–¢–∞–∫–∂–µ, –ø–æ—Å–∫–æ–ª—å–∫—É BR-R —è–≤–ª—è–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–º –¥–ª—è –æ—Ñ–∏—Å–∞ BRANCH - –Ω–µ–∑–∞–±—ã–≤–∞–µ–º –≤–∫–ª—é—á–∏—Ç—å **forwarding** –∫–∞–∫ –¥–ª—è IPv4 —Ç–∞–∫ –∏ –¥–ª—è IPv6 - –ø–∞–∫–µ—Ç–æ–≤

- –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª " **/etc/sysctl.conf**":

![](RackMultipart20231206-1-ro26pu_html_6954983fd9cf45c5.png)

img

- –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –º–æ–¥—É–ª–∏:

sysctl-p

![](RackMultipart20231206-1-ro26pu_html_4ff3670bbb039ba.png)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![](RackMultipart20231206-1-ro26pu_html_320b021988dbf6e9.png)

img

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–Ω–æ—Å—Ç—å —Å ISP:

![](RackMultipart20231206-1-ro26pu_html_5072056a15f36344.png)

img

**BR-SRV**

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∫–∞–∫ –∏ BR-R –ø—Ä–∏ –ø–æ–º–æ—â–∏ - **nmtui**

–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–¥–µ–ª—É—é—â–∏–π:

![](RackMultipart20231206-1-ro26pu_html_179fcc9877188186.png)

img

**HQ-SRV**

**HQ-SRV** –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å **HQ-R** , —Å–æ–≥–ª–∞—Å–Ω–æ –ø—É–Ω–∫—Ç—É ‚Ññ 3 –∑–∞–¥–∞–Ω–∏—è:

- "–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ HQ-R."
  - "a. –£—á—Ç–∏—Ç–µ, —á—Ç–æ —É —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –∞–¥—Ä–µ—Å."

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å HQ-SRV –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ IPv4 –∏ IPv6 –ø–æ DHCP

–ü–æ—Å–∫–æ–ª—å–∫–æ HQ-SRV –∏–º–µ–µ—Ç –≥—Ä–∞—Ñ. –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ç–µ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã "NetworkManager(native)"

- –í –¶–£–° (–¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π) –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è IPv6, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–º
- –æ—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –∞–¥—Ä–µ—Å—É "http://localhost:8080" -\> –∑–∞—Ç–µ–º –≤–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root -\> –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Ethernet-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã" -\> –Ω–∞–∂–∏–º–∞–µ–º "–í–∫–ª—é—á–∏—Ç—å" - –≤ "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è" –≤—ã–±–∏—Ä–∞–µ–º "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DHCP" -\> –≤—ã–±–∏—Ä–∞–µ–º "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"

![Shape5](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

- –≤ "–°–µ—Ç–µ–≤–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞" –≤—ã–±–∏—Ä–∞–µ–º "NetworkManager(native)"

![](RackMultipart20231206-1-ro26pu_html_b930a19ab6ea693b.png)

img

- –ü–æ—Å–ª–µ —á–µ–≥–æ - –≤—ã–ø–æ–ª–Ω—è–µ–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è "–í–µ—Ä—Å–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ IP:" IPv6 -\> –≤ "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è" –≤—ã–±–∏—Ä–∞–µ–º "–¢–æ–ª—å–∫–æ RA" (–≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞)

![](RackMultipart20231206-1-ro26pu_html_e9807141f6bd507a.png)

img

–ü–æ—Å–ª–µ —á–µ–≥–æ HQ-SRV –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã IPv4 –∏ IPv6 –ø–æ DHCP (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)

_ **–ü–û—Å–∫–æ–ª—å–∫—É HQ-SRV –æ—Å—Ç–∞–ª—Å—è –æ–¥–∏–Ω –±–µ–∑ IP - —Å–∞–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å 3-–π –ø—É–Ω–∫—Ç –∑–∞–¥–∞–Ω–∏—è –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ DHCP-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ HQ-R, –∞ —É–∂–µ –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, —Ç.–µ. –ø—É–Ω–∫—Ç—É –∑–∞–¥–∞–Ω–∏—è ‚Ññ 2** _

**3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ HQ-R.**

**a. –£—á—Ç–∏—Ç–µ, —á—Ç–æ —É —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –∞–¥—Ä–µ—Å.**

**HQ-R**

–£—Å—Ç–∞–Ω–æ–≤–∏–º –ø–∞–∫–µ—Ç dhcp-server

- –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å HQ-R –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ø–∞–∫–µ—Ç–∞ —É–ø—É—â–µ–Ω–∞ (1 –ø—Ä–∞–≤–∏–ª–æ –≤ iptables)

apt-get update &&apt-getinstall-y dhcp-server

–£–∫–∞–∂–∏–º —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä–µ—Ñ–µ–π—Å, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å DHCP-—Å–µ—Ä–≤–µ—Ä:

- **/etc/sysconfig/dhcpd** - –¥–ª—è dhcpd.service
- **/etc/sysconfig/dhcpd6** - –¥–ª—è dhcpd6.service
  - –≥–¥–µ: **ens36** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–º–æ—Ç—Ä—è—â–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å –æ—Ñ–∏—Å–∞ HQ

![](RackMultipart20231206-1-ro26pu_html_f6329f831d7831bd.png)

img

–û–ø–∏—à–∏–º [–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è DHCP —Ä–∞–±–æ—Ç–∞–±—â–µ–≥–æ —Å IPv4](https://www.opennet.ru/man.shtml?topic=dhcpd.conf&category=5&russian=2):

- —Ñ–∞–π–ª —Å –∑–∞–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –ø—É—Ç–∏ " **/etc/dhcp/dhcpd.conf.example**"

vim /etc/dhcp/dhcpd.conf

- –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö —Å—Ç—Ä–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞ —Å —à–∞–±–ª–æ–Ω–æ–º - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

![](RackMultipart20231206-1-ro26pu_html_b04236038db40b0d.png)

img

–≥–¥–µ:

- **default –∏ max - leases-time** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∞—Ä–µ–Ω–¥—ã (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
- **authoritative** - —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ–º –≤—ã–¥–∞–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å–∞
- –±–ª–æ–∫ **subnet {}** - —Å–µ—Ç—å, –º–∞—Å–∫–∞ —Å–µ—Ç–∏ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω –≤—ã–¥–∞–≤–∞–µ–º—ã—Ö IP
- –±–ª–æ–∫ **host {}** - —á—Ç–æ–±—ã –≤—ã–¥–∞—Ç—å IP-–∞–¥—Ä–µ—Å, –∏—Å—Ö–æ–¥—è –∏–∑ MAC-–∞–¥—Ä–µ—Å–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Ç–æ–≥–æ, —á–µ–π –ú–ê–°-–∞–¥—Ä–µ—Å –æ–ø–∏—Å–∞–Ω –≤ —Å–µ–∫—Ü–∏–∏ "hardware ethernet"
  - –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ MAC-–∞–¥—Ä–µ—Å —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ens33 –Ω–∞ HQ-SRV, —Ç.–∫. —É —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ –∑–∞–¥–∞–Ω–∏—é –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –∞–¥—Ä–µ—Å

–ü–æ—Å–ª–µ —á–µ–≥–æ –ø–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É "dhcpd"

dhcpd -t-cf /etc/dhcp/dhcpd.conf

- –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ - –≤ –≤—ã–≤–æ–¥–µ –¥–∞–Ω–Ω–æ–π —É—Ç–∏–ª–∏—Ç—ã –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–æ —á—Ç–æ –Ω–µ —Ç–∞–∫

–ó–∞–ø—É—Å–∫–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —Å–ª—É–∂–±—É dhcpd (–¥–ª—è IPv4):

systemctl enable--now dhcpd

–ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å –∏ –∂—É—Ä–Ω–∞–ª —Å–ª—É–∂–±—ã dhcpd:

systemctl status dhcpd

journalctl -f-u dhcpd

- –≥–¥–µ –º–æ–∂–µ–º –Ω–∞–±–ª—é–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π "[DORA](https://selectel.ru/blog/dhcp-protocol/#protocol)" –ø—Ä–æ—Ü–µ—Å—Å

![Shape6](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

–û–ø–∏—à–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è DHCP —Ä–∞–±–æ—Ç–∞–±—â–µ–≥–æ —Å IPv6:

- –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ IPv4 (dhcpd.conf) - –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/etc/dhcp/** –µ—Å—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è dhcpd6.conf

vim /etc/dhcp/dhcpd6.conf

- –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö —Å—Ç—Ä–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞ —Å —à–∞–±–ª–æ–Ω–æ–º - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

![Shape7](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

**–í–∞–∂–Ω–æ**

- **–¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –±–ª–æ–∫ "host {}" - —Ç.–∫. –æ–Ω —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ "dhcp6.client-id, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–æ–º —Ö–æ—Ç—è–±—ã –∫–∞–∫–æ–≥–æ-—Ç–æ –∞–¥—Ä–µ—Å–∞**
- **option.dhcp6.preference 255; —É–±–∏—Ä–∞–µ—Ç—Å—è –∑–Ω–∞–∫ –∫–∞–æ–º–µ–Ω—Ç–∞—Ä–∏—è "#". –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —Å –¥—Ä—É–≥–∏—Ö DHCP —Å–µ—Ä–µ–≤–µ—Ä–æ–≤. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ—Ç DHCP —Å–µ—Ä–≤–µ—Ä –≤—Å–µ–≥–æ –æ–¥–∏–Ω, –ø–æ—ç—Ç–æ–º—É —Å—Ç–∞–≤–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ 255**

–ü–æ—ç—Ç–æ–º—É –∑–∞–ø—É—Å–∫–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —Å–ª—É–∂–±—É dhcpd6

systemctl enable--now dhcpd6

–ü–æ—Å–ª–µ —á–µ–≥–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∂—É—Ä–Ω—É–ª –∏ –∏—â–µ–º —Ç–æ—Ç —Å–∞–º—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π "DUID" –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å IPv6 –∞–¥—Ä–µ—Å –¥–ª—è HQ-SRV:

journalctl -u-f dhcpd6

![Shape8](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

- –ò–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç **DUID** –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ **host-identifier option** –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HQ-R –∫–∞–∫ DHCP —Å–µ—Ä–≤–µ—Ä–∞
- –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª—É–∂–±—É dhcpd6

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π HQ-SRV –ø–æ–ª—É—á–∏—Ç IPv4 –∏ IPv6 –∞–¥—Ä–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–í–∞–∂–Ω–æ**

- –¥–ª—è IPv4 –Ω–∞ HQ-SRV –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏–ª–µ—Ç–∏—Ç —à–ª—é–∑, —Ç.–∫. —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä **option routers** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö dhcpd.conf
- –î–ª—è IPv6 —Ç–∞–∫–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–µ—Ç, —à–ª—é–∑—ã IPv6 –≤—ã–¥–∞—é—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ **RA (****[Router Advertisement](https://docs.oracle.com/cd/E19683-01/817-0573/chapter1-40/index.html)****)**

–î–ª—è —ç—Ç–æ–≥–æ –Ω–∞ HQ-R —É—Å—Ç–∞–Ω–æ–≤–∏–º –ø–∞–∫–µ—Ç radvd:

apt-getinstall-y radvd

–°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ RA –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ens36 (–Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è HQ-SRV –≤–µ—Ä–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ IPv6 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

echo net.ipv6.conf.ens36.accept\_ra =2\>\> /etc/net/sysctl.conf; systemctl restart network

–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ /etc/[radvd.conf](https://www.opennet.ru/man.shtml?topic=radvd.conf&category=5&russian=2):

vim /etc/radvd.conf

![](RackMultipart20231206-1-ro26pu_html_8ebe1d336f2a4c4e.png)

img

–≥–¥–µ:

- **AdvSendAdvert** - –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Ä–µ–∫–ª–∞–º—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –ª–∏ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞
- **AdvManagedFlag** - –ö–æ–≥–¥–∞ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ö–æ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥—Ä–µ—Å–æ–≤ –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ª—é–±—ã–º –∞–¥—Ä–µ—Å–∞–º, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å –ø–æ–º–æ—â—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥—Ä–µ—Å–æ–≤ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ñ–ª–∞–≥–∞ –æ–ø–∏—Å–∞–Ω–æ –≤ RFC 2462
- **AdvOtherConfigFlag** - –ö–æ–≥–¥–∞ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ö–æ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥—Ä—É–≥–æ–π (–Ω–µ–∞–¥—Ä–µ—Å–Ω–æ–π) –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ñ–ª–∞–≥–∞ –æ–ø–∏—Å–∞–Ω–æ –≤ RFC 2462
  - **AdvOnLink** - –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ, —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ—Ç –ø—Ä–µ—Ñ–∏–∫—Å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Å—Å—ã–ª–∫–µ. –ï—Å–ª–∏ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –≤ —Ä–µ–∫–ª–∞–º–µ –Ω–µ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–∏–∫–∞–∫–∏—Ö –∑–∞—è–≤–ª–µ–Ω–∏–π –æ —Å–≤–æ–π—Å—Ç–≤–∞—Ö –ø—Ä–µ—Ñ–∏–∫—Å–∞ "–ø–æ —Å—Å—ã–ª–∫–µ" –∏–ª–∏ "–≤–Ω–µ —Å—Å—ã–ª–∫–∏". –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ—Ñ–∏–∫—Å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥—Ä–µ—Å–∞, –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–¥—Ä–µ—Å–∞, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å—É, —è–≤–ª—è—é—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º–∏, –∞ –¥—Ä—É–≥–∏–µ - –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º–∏
  - **AdvAutonomous** - –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ, —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ—Ç –ø—Ä–µ—Ñ–∏–∫—Å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥—Ä–µ—Å–∞, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ RFC 2462
  - **AdvRouterAddr** - –ö–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ —Å–µ—Ç–µ–≤–æ–≥–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞, –∫–∞–∫ —Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç –º–æ–±–∏–ª—å–Ω—ã–π IPv6. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –º–æ–±–∏–ª—å–Ω—ã–º IPv6, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è MinRtrAdvInterval –∏ MaxRtrAdvInterval

–ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ radvd:

- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dhcpd6.service –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É radvd

systemctl restart dhcpd6

systemctl enable--now radvd

–ü–æ—Å–ª–µ —á–µ–≥–æ –≤—Å–µ —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã IPv4 –∏ IPv6 –¥–ª—è HQ-SRV –±—É–¥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å DHCP —Å–µ—Ä–≤–µ—Ä–∞ —Å —Ä–µ–∑–µ—Ä–≤—É–∞—Ü–∏–µ–π –∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ MAC-–∞–¥—Ä–µ—Å–∞ –∏ DUID:

![](RackMultipart20231206-1-ro26pu_html_7304ad28e4f66090.png)

img

**2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º FRR. –í—ã–±–µ—Ä–∏—Ç–µ –∏ –æ–±–æ—Å–Ω—É–π—Ç–µ –≤—ã–±–æ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏–∑ —Ä–∞—Å—á—ë—Ç–∞, —á—Ç–æ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º —Å–µ—Ç—å –±—É–¥–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è.**

**a. –°–æ—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–ø–æ–ª–æ–≥–∏—é —Å–µ—Ç–∏ L3.**

–ü–æ—Å–∫–æ–ª—å–∫—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ç–µ–π –ø–æ –∑–∞–¥–∞–Ω–∏—é –Ω–µ –æ–ø–∏—Å–∞–Ω–∞, —Ç–æ –Ω–∞ HQ-R –∏ –Ω–∞ BR-R –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é, –∞ –∏–º–µ–Ω–Ω–æ –Ω–∞ —Å—Ç–∞–¥–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ IP-–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–ª—é–∑–∞ –±—ã–ª–∏ –∑–∞–¥–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∞–¥—Ä–µ—Å–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ ISP

**–ê –≤–æ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è) –Ω—É–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å HQ-R –∏ BR-R —Ç—É–Ω–Ω–µ–ª–µ–º, —á—Ç–æ–±—ã –æ–±–º–µ–Ω –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Å–µ—Ç—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª —Å—Ç—Ä–æ–≥–æ –º–µ–∂–¥—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞–º–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π HQ –∏ BRANCH –∏ ISP –Ω–µ –∏–º–µ–ª –∫ –Ω–∏–º –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.**

- –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ç—É–Ω–Ω–µ–ª—å **GRE**
  - –∞ –≤ –ú–æ–¥—É–ª–µ 3 -\> –ø—É–Ω–∫—Ç–µ –∑–∞–¥–∞–Ω–∏—è ‚Ññ 7, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞—â–∏—â—ë–Ω–Ω—ã–π —Ç—É–Ω–µ–ª—å, –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ GRE —Ç—É–Ω–Ω–µ–ª—è –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–æ–º IPSec (strongswan)

–ü–æ–¥–Ω–∏–º–∞–µ–º GRE-—Ç—É–Ω–Ω–µ–ª—å –º–µ–∂–¥—É HQ-R –∏ BR-R

**HQ-R**

–ù–∞–ø–æ–º–∏–Ω–∞—é —á—Ç–æ —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "[etcnet](https://www.altlinux.org/Etcnet#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_IP-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B5%D0%B9)"

- –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ [—Ç—É–Ω–Ω–µ–ª—è—Ö –≤ etcnet](https://wiki.linuxfoundation.org/networking/tunneling)‚Äã

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ç—É–Ω–Ω–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

- –°—Ç–æ–∏—Ç –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –∏–º–µ–Ω–∞ tunl0, gre0 –∏ sit0 —è–≤–ª—è—é—Ç—Å—è –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≤ iproute2 ("base devices") –∏ –∏–º–µ—é—Ç –æ—Å–æ–±–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

mkdir /etc/net/ifaces/tun1

- –∑–∞—Ç–µ–º –æ–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª **options**

vim /etc/net/ifaces/tun1/options

![](RackMultipart20231206-1-ro26pu_html_f9ecb97e5e67f1f5.png)

img

–≥–¥–µ:

- **TUNLOCAL** - IP-–∞–¥—Ä–µ—Å ens33 –Ω–∞ HQ-R
- **TUNREMOTE** - IP-–∞–¥—Ä–µ—Å ens33 –Ω–∞ BR-R
- –Ω–∞–∑–Ω–∞—á–∞–µ–º IPv4 –∏ IPv6 –∞–¥—Ä–µ—Å –Ω–∞ —Ç—É–Ω–Ω–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

echo172.16.100.1/24 \> /etc/net/ifaces/tun1/ipv4address

echo2001:5::1/64 \> /etc/net/ifaces/tun1/ipv6address

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º—Å–ª—É–∂–±—É network

systemctl restart network

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![](RackMultipart20231206-1-ro26pu_html_6bf9f6c1c2d6a8f1.png)

img

**BR-R**

–ù–∞–ø–æ–º–∏–Ω–∞—é —á—Ç–æ —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è NetworkManager - –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ nmtui:

nmtui

- –≤—ã–±–∏—Ä–∞–µ–º "–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"

![](RackMultipart20231206-1-ro26pu_html_85681b028973872c.png)

img

- –í—ã–±–∏—Ä–∞–µ–º "–î–æ–±–∞–≤–∏—Ç—å"

![](RackMultipart20231206-1-ro26pu_html_79bfcac2f54e4288.png)

img

- –≤—ã–±–∏—Ä–∞–µ–º "IP-—Ç—É–Ω–Ω–µ–ª—å"

![](RackMultipart20231206-1-ro26pu_html_91b1853cf0b7f794.png)

img

- –ó–∞–¥–∞—ë–º –ø–æ–Ω—è—Ç–Ω–æ–π "–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è" -\> –≤ "–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã" –≤—ã–±–∏—Ä–∞–µ–º "GRE" -\> –≤ "–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π" —É–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ens33 (–≤ —Å—Ç–æ—Ä–æ–Ω—É ISP) -\> –∑–∞–¥–∞—ë–º "–õ–æ–∫–∞–ª—å–Ω—ã–π IP" (ens33 –Ω–∞ BR-R) -\> –∑–∞–¥–∞—ë–º "–£–¥–∞–ª—ë–Ω–Ω—ã–π IP" (ens33 –Ω–∞ HQ-R) -\> –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ "–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø IPv4 –∏ IPv6"

![Shape9](RackMultipart20231206-1-ro26pu_html_d6fed1bb560a18db.gif)

img

- –∑–∞–¥–∞—ë–º –ê–¥—Ä–µ—Å–∞ IPv4 –∏ IPv6 –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è -\> –Ω–∞–∂–∏–º–∞–µ–º "–û–ö"

![](RackMultipart20231206-1-ro26pu_html_9f018707eecb0634.png)

img

- –≤—ã–±–∏—Ä–∞–µ–º "–ù–∞–∑–∞–¥"

![](RackMultipart20231206-1-ro26pu_html_b4e40d54860bb3a0.png)

img

- –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å "tun1" -\> –∏ –≤—ã–±–∏—Ä–∞–µ–º "–í—ã–π—Ç–∏"

![](RackMultipart20231206-1-ro26pu_html_d1cc422ba1004a7f.png)

img

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä TTL –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Ç—É–Ω–Ω–µ–ª—è:

nmcli connection modify tun1 ip-tunnel.ttl 64

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![](RackMultipart20231206-1-ro26pu_html_8b7852c77ae8b62c.png)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–Ω–æ—Å—Ç—å –ø–æ —Ç—É–Ω–Ω–µ–ª—é BR-R -\> HQ-R:

![](RackMultipart20231206-1-ro26pu_html_125e44e918f67421.png)

img

**–°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π (—Ç—É–Ω–Ω–µ–ª—å) –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è HQ-R –∏ BR-R (–æ–Ω–∏ –±—É–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π HQ –∏ BRANCH —á–µ—Ä–µ–∑ —ç—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ).**

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π) –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏** **[frr](https://frrouting.org/)**‚Äã

**HQ-R**

–£—Å—Ç–∞–Ω–æ–≤–∏–º –ø–∞–∫–µ—Ç frr:

apt-getinstall-y frr

- –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ [frr](https://docs.frrouting.net/en/latest/overview.html)‚Äã
- –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è IPv4 –∏ IPv6 –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª [OSPFv2](http://docs.frrouting.org/en/stable-8.0/ospfd.html) –∏ [OSPFv3](http://docs.frrouting.org/en/latest/ospf6d.html)‚Äã

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ " **/etc/frr/daemons**" –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

vim /etc/frr/daemons

- –ø–µ—Ä–µ–≤–æ–¥–∏–º **ospfd=no** –≤ **ospfd=yes** - –¥–ª—è OSPFv2 (IPv4)
- –ø–µ—Ä–µ–≤–æ–¥–∏–º **ospf6d=no** –≤ **ospfd6=yes** - –¥–ª—è OSPFv3 (IPv3)

![](RackMultipart20231206-1-ro26pu_html_b08fa3cc89ce0b05.png)

img

–í–∫–ª—é—á–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —Å–ª—É–∂–±—É frr:

systemctl enable--now frr

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º OSPFv2 - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å frr –ø—Ä–∏ –ø–æ–º–æ—â–∏ "vtysh":

vtysh

![](RackMultipart20231206-1-ro26pu_html_cd1a95baecd84e3b.png)

img

–≥–¥–µ:

- **configure terminal** - –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **router ospf** - –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ OSPFv2
- **passive-interface default** - –ø–µ—Ä–µ–≤–æ–¥ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤ –ø–∞—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:
  - –¥–∞–ª–µ–µ —Ç—É–Ω–Ω–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å "tun1" –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–º, –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–æ—Å–µ–¥—Å—Ç–≤–æ —Å BR-R –∏ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
- **network** - –æ–±—ä—è–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å –æ—Ñ–∏—Å–∞ HQ –∏ —Ç—É–Ω–Ω–µ–ª—å–Ω—É—é —Å–µ—Ç—å
- –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å tun1 –≤ –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
- —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º OSPFv3:

![](RackMultipart20231206-1-ro26pu_html_f2db4f7bfbaccc20.png)

img

–≥–¥–µ:

- **router ospf6** - –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ OSPFv3
- **ospf6 router-id** - –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–æ–º–µ—Ä router-id
- –¥–∞–ª–µ–µ –¥–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ **tun1** –∏ **ens36** –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é OSPFv3
- —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**BR-R**

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º frr –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OSPFv2 –∏ OSPFv3 –∫–∞–∫ –∏ –Ω–∞ HQ-R, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–∞:

dnf install-y frr

–¥–∞–ª–µ–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –Ω–∞ HQ-R

- OSPFv2:

![](RackMultipart20231206-1-ro26pu_html_e96f72ee5a8226e6.png)

img

- OSPFv3:

![](RackMultipart20231206-1-ro26pu_html_18496e638c9802c1.png)

img

**–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:**

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å–µ–¥—Å—Ç–≤–æ –ø–æ IPv4 –∏ IPv6 —Å BR-R:

![](RackMultipart20231206-1-ro26pu_html_86d4722488940f4e.png)

img

–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å BR-R:

![](RackMultipart20231206-1-ro26pu_html_33ac2e31b4aa7360.png)

img

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–º —Ç–∞–±–ª–∏—Ü—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ HQ-R:

- –≤–∏–¥–∏–º –º–∞—Ä—à—Ä—É—Ç –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å –æ—Ñ–∏—Å–∞ BRANCH –ø–æ IPv4 –∏ IPv6

![](RackMultipart20231206-1-ro26pu_html_e10f913f349b3eab.png)

img

–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å BR-R:

- –≤–∏–¥–∏–º –º–∞—Ä—à—Ä—É—Ç –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å –æ—Ñ–∏—Å–∞ HQ –ø–æ IPv4 –∏ IPv6

![](RackMultipart20231206-1-ro26pu_html_69c47c0161bc48af.png)

img

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–º —Å–≤—è–∑–Ω–æ—Å—Ç—å —Å HQ-SRV -\> BR-SRV:

- —Å–≤—è–∑–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

![](RackMultipart20231206-1-ro26pu_html_48b06a1f815a3a08.png)

img

- —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–≤—è–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Å–µ—Ç—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º frr

![](RackMultipart20231206-1-ro26pu_html_b186c187fc3c02b6.png)

img

**a. –°–æ—Å—Ç–∞–≤—å—Ç–µ** **[—Ç–æ–ø–æ–ª–æ–≥–∏—é —Å–µ—Ç–∏ L3](https://www.youtube.com/watch?v=rYI_TFPGGyI&pp=ygUVTDMg0LTQuNCw0LPRgNCw0LzQvNCw)****.**

![](RackMultipart20231206-1-ro26pu_html_574378a9078d8314.png)

img

**4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π 2.**

![](RackMultipart20231206-1-ro26pu_html_9c0ce2fe51759856.png)

img

**CLI**

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –¶–£–° -\> –≤—ã–±—Ä–∞–≤ –≤–∫–ª–∞–¥–∫—É "–õ–æ–∫–∞–ª—å–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏"

![](RackMultipart20231206-1-ro26pu_html_fe5be5e8d311a6b8.png)

img

- –≤ —Ñ–æ—Ä–º–µ "–ù–æ–≤–∞—è —É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å:" –ø–∏—à–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -\> –Ω–∞–∂–∏–º–∞–µ–º "–°–æ–∑–¥–∞—Ç—å"

![](RackMultipart20231206-1-ro26pu_html_562e01adb086f2d1.png)

img

- —Ç.–∫. –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∑–∞–≥–ª–∞–Ω–æ–π –±—É–∫–≤—ã –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ 2 -\> –≤ "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:" –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å "Admin" –∫–∞–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ 2 -\> —Ç–∞–∫–∂–µ –∑–∞–¥–∞—ë–º –ø–∞—Ä–æ–ª—å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –µ–≥–æ -\> –Ω–∞–∂–∏–º–∞–µ–º "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"

![](RackMultipart20231206-1-ro26pu_html_bd20a421e4b04b76.png)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

grep admin /etc/passwd

![](RackMultipart20231206-1-ro26pu_html_8c181f6faaea04d9.png)

img

**HQ-SRV**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞—Ç—å –º–æ–∂–Ω–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∫–∞–∫ –∏ –Ω–∞ CLI - —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –¶–£–°

![](RackMultipart20231206-1-ro26pu_html_f1d2c70e31c224c1.png)

img

**HQ-R**

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ [useradd](https://www.opennet.ru/man.shtml?topic=useradd&category=8&russian=0)‚Äã

useradd admin -m-c"Admin"-U

–≥–¥–µ:

- **admin** - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **-m** - –µ—Å–ª–∏ –¥–æ–º–∞—à–Ω–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Ç–æ –æ–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω
- **-c "Admin"** - –ª—é–±–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞. –û–±—ã—á–Ω–æ, –∑–¥–µ—Å—å –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å, –∏ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **-U** - c–æ–∑–¥–∞–π—Çc—è –≥—Ä—É–ø–ø–∞ —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º, —á—Ç–æ –∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –¥–æ–±–∞–≤–ª—è–µ–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —ç—Ç—É –≥—Ä—É–ø–ø—É

–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –µ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å:

- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–≤–∞–∂–¥—ã —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–æ–ª—è - "P@ssw0rd"

passwd admin

![](RackMultipart20231206-1-ro26pu_html_d2b1855c2f0a4f45.png)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![](RackMultipart20231206-1-ro26pu_html_c9653086f4b5dc71.png)

img

- –≤—Ö–æ–¥ –ø–æ–¥ —Å–æ–∑–¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

![](RackMultipart20231206-1-ro26pu_html_5e0455a5ef7183f9.png)

img

**BR-R | BR-SRV**

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–∏ –ø–æ–º–æ—â–∏ —É—Ç–∏–ª–∏—Ç—ã "useradd"

![](RackMultipart20231206-1-ro26pu_html_147d74bcd9293b79.png)

img

_–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É "userdel"_

userdel\<USER\_NAME\>

–≥–¥–µ:

- **\<USER\_NAME\>** - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å
  - **-f, --force** - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
  - **-r, --remove** - —É–¥–∞–ª–∏—Ç—å –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ —Ñ–∞–π–ª—ã –≤ —Å–∏—Å—Ç–µ–º–µ

**5. –ò–∑–º–µ—Ä—å—Ç–µ –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —É–∑–ª–∞–º–∏ HQ-R-ISP –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º —É—Ç–∏–ª–∏—Ç—ã iperf 3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–∞ —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º–∏.**

**ISP | HQ-R**

–ù–∞ ISP –∏ HQ-R –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç "[iperf3](https://ru.wikipedia.org/wiki/Iperf)" [–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏](https://sysadmin78.ru/doku.php/how_to:test_network_throughput_using_iperf3_tool_in_linux)‚Äã

apt-getinstall-y iperf3

–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã iperf3

systemctl enable--now iperf3

**HQ-R**

–ó–∞—Ç–µ–º –Ω–∞ HQ-R, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å, –∑–∞–ø—É—Å—Ç–∏–º iperf3 –≤ —Ä–µ–∂–∏–º–µ –∫–ª–∏–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–ª–∞–≥ -c, –∏ —É–∫–∞–∂–µ–º —Ö–æ—Å—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä -\> ISP (1.1.1.1)

iperf3 -c1.1.1.1

![](RackMultipart20231206-1-ro26pu_html_dd914133054268af.png)

img

- –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ " **--get-server-output**" - –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
  - –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ –≤ –≤—ã–≤–æ–¥–µ –∫–ª–∏–µ–Ω—Ç–∞
- –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ " **--logfile /path/to/file**" - –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω–æ–π –∫–∞–º–∞–Ω–¥—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç—á—ë—Ç–∞

![](RackMultipart20231206-1-ro26pu_html_e678948fecfa5ef4.png)

img

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ª—É—á–∏–≤—à–µ–≥–æ—Å—è —Ñ–∞–π–ª–∞ –æ—Ç—á—ë—Ç–∞:

![](RackMultipart20231206-1-ro26pu_html_7d1ad35e1f1a3bac.png)

img

![](RackMultipart20231206-1-ro26pu_html_a0b9ce5cf7c1a512.png)

img

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ –º–µ–∂–¥—É HQ-R -\> ISP —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 3.87 –ì–±–∏—Ç/—Å –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –∏ 3.87 –ì–±–∏—Ç/—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. –¢–∞–∫–∂–µ –∑–∞ 10 —Å–µ–∫—É–Ω–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª–æ –ø–µ—Ä–µ–¥–∞–Ω–æ 4.51 –ì–ë –¥–∞–Ω–Ω—ã—Ö

**6. –°–æ—Å—Ç–∞–≤—å—Ç–µ backup —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∞ –∏–º–µ–Ω–Ω–æ HQ-R BR-R. –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∏—Ö —Ä–∞–±–æ—Ç—É.**

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–æ–π bash-—Å–∫—Ä–∏–ø—Ç:

vim backup-srcipt.sh

![](RackMultipart20231206-1-ro26pu_html_a29fda7da26b7a61.png)

img

–î–∞–¥–∏–º –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:

chmod +x backup-script.sh

![](RackMultipart20231206-1-ro26pu_html_fc5cfb5685e1b8e.png)

img

–≥–¥–µ:

- **#!/bin/bash** : –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ - —ç—Ç–æ —à–µ–±–∞–Ω–≥ (shebang), –æ–Ω–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, –∫–∞–∫—É—é –æ–±–æ–ª–æ—á–∫—É —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±–æ–ª–æ—á–∫–∏ Bash.
- **echo "Start backup!"** : –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç "Start backup!" –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ (–æ–±—ã—á–Ω–æ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª).
- **backup\_dir="/etc"**": –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é backup\_dir –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –µ–π –∑–Ω–∞—á–µ–Ω–∏–µ "/etc". –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è.
  - –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ "–∫–∞–≤—ã—á–∫–∞—Ö" —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä **backup\_dir="/etc /var /home"**
- **dest\_dir="/opt/backup"** : –ó–¥–µ—Å—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è dest\_dir –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ "/opt/backup". –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∞—Ä—Ö–∏–≤.
- **mkdir -p $dest\_dir** : –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π dest\_dir —Å –æ–ø—Ü–∏–µ–π **-p** , –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥, –∞ —Ç–∞–∫–∂–µ –≤—Å–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∏, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
- **tar -czf $dest\_dir/$(hostname -s)-$(date +"%d.%m.%y").tgz $backup\_dir**: –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç tar –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π backup\_dir. –ê—Ä—Ö–∏–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π dest\_dir, —Å –∏–º–µ–Ω–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –≤–∫–ª—é—á–∞–µ—Ç –∏–º—è —Ö–æ—Å—Ç–∞ (hostname), —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ".tgz". –û–ø—Ü–∏–∏ -czf —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –∞—Ä—Ö–∏–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∂–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ gzip.
- **echo "Done!"** : –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç "Done!" –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞.

–í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞:

backup-script.sh

![](RackMultipart20231206-1-ro26pu_html_46d216ef754429f8.png)

img

–ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞:

tar-tf /opt/backup/hq-r-29.10.23.tgz |less

![](RackMultipart20231206-1-ro26pu_html_1868f0bb8d82e4ff.png)

img

- —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–∫—Ä–∏–ø—Ç –∑–∞–ø–∏—Å–∞–ª –≤ –∞—Ä—Ö–∏–≤ –≤—Å—ë —Å–æ–¥–µ—Ä–¥–∂–∏–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/etc**
  - —Ç–∞–∫–∂–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –æ–¥–Ω—É, –∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å —Ü–µ–ª—å—é —Ä–µ–∑–µ–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Å–µ–≥–æ–ª–∏—à—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é **backup\_dir** —Å–∫—Ä–∏–ø—Ç–∞ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    - **backup\_dir="/etc /var /home"**

**BR-R**

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ–º –∏ –Ω–∞ BR-R

- –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞, –ø–µ—Ä–µ–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç —Å HQ-R –Ω–∞ BR-R –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç –º–æ–∂–Ω–æ –ø–æ **scp**

![](RackMultipart20231206-1-ro26pu_html_fe0bada5b60c9beb.png)

img

**7. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ HQ-SRV –ø–æ –ø–æ—Ä—Ç—É 2222. –£—á—Ç–∏—Ç–µ, —á—Ç–æ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ —ç—Ç–æ—Ç –ø–æ—Ä—Ç –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞.**

**HQ-SRV**

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ "**[/etc/openssh/sshd\_config](https://www.opennet.ru/man.shtml?topic=sshd_config&category=5&russian=0)**":

- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø–æ—Ä—Ç SSH —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–∏—é - —ç—Ç–æ 2222;
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root

![](RackMultipart20231206-1-ro26pu_html_e29f2f7748963501.png)

img

–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑—É–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É sshd

systemctl restart sshd

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å SSH –º–æ–∂–Ω–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

ss -tlpn|grepssh

![](RackMultipart20231206-1-ro26pu_html_fdb0e0574572f467.png)

img

_**–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ —ç—Ç–æ—Ç –ø–æ—Ä—Ç –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ - –º–æ–∂–Ω–æ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ firewall (netfilter) –Ω–∞ HQ-R**_

**HQ-R**

–í—ã–ø–æ–ª–Ω–∏–º —É—Å—Ç–∞–Ω–æ–≤–∫—É [nftables](https://ru.wikipedia.org/wiki/Nftables)‚Äã

apt-getinstall-y nftables

–í–∫–ª—é—á–∏–º –∏ –¥–æ–±–∞–≤–∏–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É, –∞ —Ç–∞–∫–∂–µ –æ—á–∏—Å—Ç–∏–º nftables –ø–æ–ª–Ω–æ—Å—Ç—å—é

systemctl enable--now nftables

nft flush ruleset

–°–æ–∑–¥–∞–¥–∏–º —Å–ª–µ–¥—É—é—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –≤–Ω–µ—à–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç 22 -\> –Ω–∞ –ø–æ—Ä—Ç 2222 —Å–µ—Ä–≤–µ—Ä–∞ HQ-SRV:

- —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É "nat" - –¥–ª—è —Å–µ–º–µ–π—Å—Ç–≤–∞ "inet"
  - –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–µ–º–µ—Å—Ç–≤–∞—Ö –≤ [nftables](https://wiki.archlinux.org/title/Nftables_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9))‚Äã
    - –°–µ–º–µ–π—Å—Ç–≤–æ inet –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã IPv4 –∏ IPv6

nft add table inet nat

- –¥–æ–±–∞–≤–∏–º —Ü–µ–ø–æ—á–∫—É "prerouting" –≤ —Ç–∞–±–ª–∏—Ü—É "nat"
  - PREROUTING ‚Äî –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –ø–∞–∫–µ—Ç–æ–≤, –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–∫ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å–µ—Ä–≤–µ—Ä—É, —Ç–∞–∫ –∏ –¥—Ä—É–≥–∏–º —É–∑–ª–∞–º —Å–µ—Ç–∏. –°—é–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

nft add chain inet nat prerouting '{ type nat hook prerouting priority 0; }'

- –¥–æ–±–∞–≤–∏–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ –≤ —Ü–µ–ø–æ—á–∫—É "prerouting" —Ç–∞–±–ª–∏—Ü—ã "nat" —Å–µ–º–µ–π—Å—Ç–≤–∞ "inet"

nft add rule inet nat prerouting ip daddr 1.1.1.2 tcp dport 22 dnat to 192.168.100.1:2222

nft add rule inet nat prerouting ip6 daddr 2001:1::2 tcp dport 22 dnat to [2001:100::1]:2222

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤–∏–ª:

nft list ruleset

![](RackMultipart20231206-1-ro26pu_html_1761bfa9e57da083.png)

img

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª nftables:

echo"#!/usr/sbin/nft -f"\> /etc/nftables/nftables.nft

echo"flush ruleset"\>\> /etc/nftables/nftables.nft

nft list ruleset \>\> /etc/nftables/nftables.nft

- —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ nftables.nft - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º

![](RackMultipart20231206-1-ro26pu_html_3c683d925c568eb.png)

img

- –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º nftables

systemctl restart nftables

–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å CLI

**CLI**

- –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ SSH –∏—Å–ø–æ–ª—å–∑—É—è –≤–Ω–µ—à–Ω–∏–π IPv4 –∏ IPv6 –∞–¥—Ä–µ—Å–∞ HQ-R

![](RackMultipart20231206-1-ro26pu_html_389b5d764c8e8e24.png)

img

**8. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –¥–æ HQ-SRV –ø–æ SSH —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∫—Ä–æ–º–µ CLI.**

**HQ-SRV**

–û–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ—Å—Ç—É–ø —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ SSH:

- —Ä–∞–∑—Ä–µ—à–∏–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å CLI –ø–æ IPv4 –∏ IPv6;
- —Ä–∞–∑—Ä–µ—à–∏–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ root –∏ admin

–î–æ–±–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ **/etc/openssh/sshd\_config**

![](RackMultipart20231206-1-ro26pu_html_384aa01d8c06aac.png)

img

–ü—Ä–æ–≤–µ—Ä–∏–º:

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å CLI:
  - –ø–æ IPv4 –∏ IPv6 –∏–∑ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π "root" –∏ "admin"

![](RackMultipart20231206-1-ro26pu_html_1487703e29a24c5.png)

img

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å HQ-R –∏–ª–∏ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ —Ö–æ—Å—Ç–∞:

![](RackMultipart20231206-1-ro26pu_html_edc0aac69a353ebf.png)

img

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –Ω–∞ CLI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SSH-–∫–ª—é—á–∏, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∫–ª—é—á–∞–º, –∞ –Ω–µ –ø–æ –ø–∞—Ä–æ–ª—é:

ssh-keygen -t rsa

![](RackMultipart20231206-1-ro26pu_html_d2c814147133ae98.png)

img

- –ø–µ—Ä–µ–¥–∞–¥–∏–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:

ssh-copy-id admin@1.1.1.2

![](RackMultipart20231206-1-ro26pu_html_dc5a276edf4a7a0e.png)

img

ssh-copy-id root@1.1.1.2

![](RackMultipart20231206-1-ro26pu_html_91f2bb326e0b48c5.png)

img

–ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∏–∑ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "admin" –∏ –ø—Ä–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "root"

- –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root - –º–æ–∂–Ω–æ –≤–æ–æ–±—â–µ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

![](RackMultipart20231206-1-ro26pu_html_fe553479e0df8ea3.png)

img

**HQ-SRV**

–í–Ω–µ—Å—ë–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª SSH - —á—Ç–æ–±—ã –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ –ø–∞—Ä–æ–ª—é, –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á—É:

![](RackMultipart20231206-1-ro26pu_html_e761d5f0be48d43b.png)

img

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –¥–æ HQ-SRV –ø–æ SSH –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ —Å–ª—É–∂–±—ã sshd:

- –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ—Å—Ç—É–ø —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö IPv4 –∏ IPv6 –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;
- –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –ø–∞—Ä–æ–ª—é, —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É

**–ó–∞–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è 2**

–í –Ω–∞—á–∞–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –µ–¥–∏–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö. –î–∞–ª–µ–µ –ø–µ—Ä–µ–π–¥–µ–º –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–º–µ–Ω–∞, –≤—ã–±—Ä–∞–≤ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø –∏ –æ–±–æ—Å–Ω–æ–≤–∞–≤ —ç—Ç–æ—Ç –≤—ã–±–æ—Ä. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ DNS-—Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–Ω –≤ —Å–µ—Ç–∏.

**2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É —Å–µ—Ç–µ–≤—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É NTP.**

**a. –í –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –≤—ã—Å—Ç—É–ø–∞—Ç—å —Ä–æ—É—Ç–µ—Ä HQ-R —Å–æ —Å—Ç—Ä–∞—Ç—É–º–æ–º 5**

**b. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Loopback –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ HQ-R, –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–µ—Ä–≤–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏**

**c. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ –≤—Ä–µ–º—è —Å —Ä–æ—É—Ç–µ—Ä–æ–º HQ-R**

**d. –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –º–æ—Å–∫–æ–≤—Å–∫–∏–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (UTC +3)**

**HQ-R**

–ù–∞—Å—Ç—Ä–æ–∏–º –º–æ—Å–∫–æ–≤—Å–∫–∏–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (UTC +3):

timedatectl set-timezone Europe/Moscow

–ü—Ä–æ–≤–µ—Ä–∏–º:

timedatectl

- man [timedatectl](http://man.he.net/man1/timedatectl)‚Äã

![](RackMultipart20231206-1-ro26pu_html_6e4f52d3efa8f4a.png)

img

–£—Å—Ç–∞–Ω–æ–≤–∏–º–ø–∞–∫–µ—Ç[chrony](https://chrony-project.org/):

apt-getinstall-y chrony

–ü—Ä–∏–≤–æ–¥–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª "[chrony.conf](https://manpages.ubuntu.com/manpages/impish/man5/chrony.conf.5.html)" –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–∏–¥—É:

vim /etc/chrony.conf

![](RackMultipart20231206-1-ro26pu_html_bbc0c2cdf8fa8ca7.png)

img

**–≥–¥–µ:**

- **server 127.0.0.1** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Loopback –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ HQ-R, –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–µ—Ä–≤–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
- **local stratum 5** - —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã—Å—Ç—É–ø–∞—Ç—å —Å–æ —Å—Ç—Ä–∞—Ç—É–º–æ–º 5
- **allow** - –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø–æ–¥—Å–µ—Ç–∏:
  - **192.168.100.0/26** - HQ-local
  - **192.168.200.0/28** - BRANCH-local
  - **172.16.100.0/24** - HQ \<-TUNNEL-\> BRANCH
  - **4.4.4.0/30** - CLI -\> HQ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
  - **1.1.1.0/30** - ISP -\> HQ-R (–≤—Å–µ –¥–∞–∫ –≤—Å–µ)

–ó–∞–ø—É—Å–∫–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —Å–ª—É–∂–±—É chronyd:

systemctl enable--now chronyd

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

chronyc sources

chronyc tracking

![](RackMultipart20231206-1-ro26pu_html_4b72911adc807d7c.png)

img

–ù–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

timedatectl set-timezone Europe/Moscow

–ê —Ç–∞–∫–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç chrony, –∑–∞–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ NTP-—Å–µ—Ä–≤–µ—Ä–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ —É–∫–∞–∑–∞—Ç—å IP-–∞–¥—Ä–µ—Å HQ-R –≤ –∫–∞—á–µ—Å—Ç–≤–µ NTP-—Å–µ—Ä–≤–µ—Ä–∞, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–¥—Å–µ—Ç–∏

–ù–∞–ø—Ä–∏–º–µ—Ä:

**BR-R**

![](RackMultipart20231206-1-ro26pu_html_dc1668730f503bff.png)

img

**BR-SRV**

![](RackMultipart20231206-1-ro26pu_html_3d819bdae04276f1.png)

img

**CLI**

![](RackMultipart20231206-1-ro26pu_html_9fa2a2de1344058e.png)

img

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É **HQ-R** –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 –∫–ª–∏–µ–Ω—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è ISP):

**HQ-R**

chronyc clients

![](RackMultipart20231206-1-ro26pu_html_e4cc2962e73f1c82.png)

img

**3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–µ—Ä –¥–æ–º–µ–Ω–∞ –≤—ã–±–æ—Ä, –µ–≥–æ —Ç–∏–ø–∞ –æ–±–æ—Å–Ω—É–π—Ç–µ, –Ω–∞ –±–∞–∑–µ HQ-SRV —á–µ—Ä–µ–∑ web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –≤—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –æ–±–æ—Å–Ω—É–π—Ç–µ.**

- –í—ã–±–æ—Ä –¥–æ–º–µ–Ω–∞ - AD + Samba DC ([—Å–º. –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ](https://www.youtube.com/watch?v=H884n_zvDS4))
- –£—Å—Ç–∞–Ω–æ–≤–∏–º [–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã](https://docs.altlinux.org/ru-RU/domain/10.2/html/samba/index.html):

apt-getinstall-y task-samba-dc admc

–¢–∞–∫ –∫–∞–∫ Samba –≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞ (Domain Controller, DC) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ —Å–≤–æ–π LDAP, —Ç–∞–∫ –∏ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä Kerberos, –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å MIT Kerberos, –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Å–ª—É–∂–±—ã **krb5kdc** –∏ **slapd** , –∞ —Ç–∞–∫–∂–µ **bind**

- –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è —É–∑–ª–∞ –∏ –¥–æ–º–µ–Ω–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

hostnamectl set-hostname hq-srv.hq.work; execbash

domainname hq.work

_–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É._

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤—Å–µ—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö DNS-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–∞–π–ª–µ **/etc/resolvconf.conf** –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∞:

name\_servers=127.0.0.1

- –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å resolvconf

resolvconf -u

- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é Samba

rm-f /etc/samba/smb.conf

rm-rf /var/lib/samba

rm-rf /var/cache/samba

mkdir-p /var/lib/samba/sysvol

–û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä -\> –ø–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ "http://localhost:8080" -\> –≤–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "root" -\> –Ω–∞–∂–∏–º–∞–µ–º "–í–æ–π—Ç–∏":

![](RackMultipart20231206-1-ro26pu_html_f07e72702a39c9d.png)

img

- –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î–æ–º–µ–Ω" -\> –≤ –ø–æ–ª–µ "–ò–º—è –¥–æ–º–µ–Ω–∞" –ø–∏—à–∏–º –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è -\> –≤ –∫–∞—á–µ—Å—Ç–≤–µ "–¢–∏–ø –¥–æ–º–µ–Ω–∞" –≤—ã–±–∏—Ä–∞–µ–º Active Directory

![](RackMultipart20231206-1-ro26pu_html_52108df24c57aac6.png)

img

- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–¥–∞—ë–º –≤–Ω–µ—à–Ω–∏–π DNS -\> –≤–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -\> –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å -\> –Ω–∞–∂–∏–º–∞–µ–º "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"

![](RackMultipart20231206-1-ro26pu_html_f6b7d1c12b7b9a8d.png)

img

- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä -\> –ø–æ–ª—É—á–∞–µ–º –±–∏–ª–µ—Ç: –≤–≤–æ–¥–∏–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è administrator –∏ –ø–∞—Ä–æ–ª—å –∑–∞–¥–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

![](RackMultipart20231206-1-ro26pu_html_182dd3c2abc795c4.png)

img

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Kerberos

–í –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–º–µ–Ω–∞ Samba –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω —Ñ–∞–π–ª–∞ krb5.conf –¥–ª—è –¥–æ–º–µ–Ω–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ /var/lib/samba/private/. –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º —Ñ–∞–π–ª, –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ /etc/:

cp /var/lib/samba/private/krb5.conf /etc/krb5.conf

–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞:

![](RackMultipart20231206-1-ro26pu_html_3f22218ce95a9f25.png)

img

**b. –û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –¥–æ–º–µ–Ω—É**

–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –¥–æ–º–µ–Ω—É –º–æ–∂–Ω–æ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –æ—Å–Ω–∞—Å—Ç–∫–∏ [ADMC](https://www.altlinux.org/ADMC):

![](RackMultipart20231206-1-ro26pu_html_a2aca798880b5c29.png)

img

![](RackMultipart20231206-1-ro26pu_html_d3918c42b7d5fe64.png)

img

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –∏–º–µ–µ—Ç –≥—Ä–∞—Ñ. –æ–±–æ–ª–æ—á–∫–∏, —Å CLI (–ê–ª—å—Ç —Ä–∞–±–æ—á–∞—è —Å—Ç–∞–Ω—Ü–∏—è), –∏—Å–ø–æ–ª—å–∑—É—è –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å HQ**

**a. –í–≤–µ–¥–∏—Ç–µ –º–∞—à–∏–Ω—ã BR-SRV –∏ CLI –≤ –¥–∞–Ω–Ω—ã–π –¥–æ–º–µ–Ω**

**CLI**

–í–≤–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –¥–æ–º–µ–Ω:

- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –≤ —Å–µ—Ç—å HQ local - —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

![](RackMultipart20231206-1-ro26pu_html_4a0c95d5deed8c9d.png)

img

![](RackMultipart20231206-1-ro26pu_html_92e5387df7ad15af.png)

img

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - —á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ. –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–∫–ª—é—á–∞–µ–º –∏ –≤–∫–ª—é—á–∞–µ–º —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![](RackMultipart20231206-1-ro26pu_html_280b13d92dbdf2dd.png)

img

–î–∞–ª–µ–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–∫–ª—é—á–µ–Ω–∏—è –∫ HQ - –ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ DNS:

![](RackMultipart20231206-1-ro26pu_html_9338f61ce0791934.png)

img

–î–∞–ª–µ–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¶–£–° -\> –≤ —Ä–∞–∑–¥–µ–ª "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è":

![](RackMultipart20231206-1-ro26pu_html_682df4e6fc59967b.png)

img

–í—ã–±–∏—Ä–∞–µ–º "–î–æ–º–µ–Ω Active Directory" -\> –Ω–∞–∂–∏–º–∞–µ–º "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"

![](RackMultipart20231206-1-ro26pu_html_48fea33ffc5833e9.png)

img

–í–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞ -\> –Ω–∞–∂–∏–º–∞–µ–º "–û–ö"

![](RackMultipart20231206-1-ro26pu_html_f08e68a1be60a808.png)

img

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞

![](RackMultipart20231206-1-ro26pu_html_bece79ccd55d38df.png)

img

**HQ-SRV**

–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ ADMC:

![](RackMultipart20231206-1-ro26pu_html_d3c86836ad46ccbb.png)

img

**BR-SRV**

–í–≤–æ–¥ BR-SRV –≤ –¥–æ–º–µ–Ω:

–ü—Ä–∏ –ø–æ–º–æ—â–∏ nmtui –ø—Ä–∞–≤–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS:

![](RackMultipart20231206-1-ro26pu_html_55322ed824fb89d6.png)

img

–î–ª—è –≤–≤–æ–¥–∞ –≤ –¥–æ–º–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–∏–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –ø–∞–∫–µ—Ç:

dnf install-y realm-to-domain

–í –†–ï–î –û–° –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ –¥–æ–º–µ–Ω Windows/SAMBA –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ [join-to-domain](https://redos.red-soft.ru/base/arm/arm-domen/arm-msad/join-to-domain/). –£—Ç–∏–ª–∏—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞ –≤ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–º (—Ç–µ–∫—Å—Ç–æ–≤–æ–º) –∏ –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ

join-to-domain.sh

![](RackMultipart20231206-1-ro26pu_html_d7725f046b774dd6.png)

img

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä

**HQ-SRV**

–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ ADMC:

![](RackMultipart20231206-1-ro26pu_html_f84d98c22286492c.png)

img

**1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ HQ-SRV:**

**a. –ù–∞ DNS —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å 2 –∑–æ–Ω—ã**

–ó–æ–Ω–∞ hq.work, —Ç–∞–∫–∂–µ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é –∑–æ–Ω—É.

![](RackMultipart20231206-1-ro26pu_html_6f9dcb85c476632.png)

img

–ü—Ä–∏ –ø–æ–º–æ—â–∏ —É—Ç–∏–ª–∏—Ç—ã [samba-tool](https://ru.linux-console.net/?p=1670) –ø—Ä–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–∏–µ –µ—Å—Ç—å –∑–æ–Ω—ã –≤ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–º —Ä–∞–Ω–µ–µ –¥–æ–º–µ–Ω–µ:

samba-tool dns zonelist 127.0.0.1 -U administrator

![](RackMultipart20231206-1-ro26pu_html_82b3fe35ae0ace7e.png)

img

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∑–æ–Ω—É "branch.work", –∞ —Ç–∞–∫–∂–µ –∑–æ–Ω—ã –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:

samba-tool dns zonecreate 127.0.0.1 branch.work -U administrator

samba-tool dns zonecreate 127.0.0.1 100.168.192.in-addr.arpa -U administrator

samba-tool dns zonecreate 127.0.0.1 200.168.192.in-addr.arpa -U administrator

![](RackMultipart20231206-1-ro26pu_html_4a3b9533dfd56a3f.png)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![](RackMultipart20231206-1-ro26pu_html_23f2e8827fb7ef18.png)

img

–°–æ–∑–¥–∞—ë–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–ø–∏—Å–∏ DNS:

samba-tool dns add127.0.0.1 hq.work hq-r A 192.168.100.62 -U administrator

- –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π —Ç–∏–ø–∞ –ê

![](RackMultipart20231206-1-ro26pu_html_e804e835c1b0dbcc.png)

img

samba-tool dns add127.0.0.1 100.168.192.in-addr.arpa 1 PTR hq-srv.hq.work -U administrator

- –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π —Ç–∏–ø–∞ PTR

![](RackMultipart20231206-1-ro26pu_html_a407a826125c7174.png)

img

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ—Å—Ç—É–ø –ø–æ –∏–º–µ–Ω–∞–º:

**CLI**

- –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–Ω—É hq.work

![](RackMultipart20231206-1-ro26pu_html_3344f60af2926721.png)

img

- –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–Ω—É branch.work

![](RackMultipart20231206-1-ro26pu_html_95c8f3329dc16c.png)

img